// Uses AMD or browser globals to create a jQuery plugin.

// It does not try to register in a CommonJS environment since
// jQuery is not likely to run in those environments.
// See jqueryPluginCommonJs.js for that version.

/**
 * Input Grid - jQuery Plugin
 *
 * Version: 0.1.1 (5/21/2012)
 * Requires: jQuery v1.7+
 *
 * Copyright (c) 2011 Adam Draper - http://github.com/adamwdraper
 * Under MIT and GPL licenses:
 *  http://www.opensource.org/licenses/mit-license.php
 *  http://www.gnu.org/licenses/gpl.html
 */
(function(a){typeof define=="function"&&define.amd?define(["jQuery"],a):a(jQuery)})(function(a){var b,c=a('<div class="beacon"></div>'),d={},e={init:function(b){return this.each(function(){var e=a(this),f=e.offset(),g=e.data("initialized");g||(e=a(this),e.data("initialized",!0),e.append(c),d={width:e.width(),height:e.height(),left:f.left,top:f.top,x:{value:b.x.value||b.x.min||0,min:b.x.min||0,max:b.x.max||20},y:{value:b.y.value||b.y.min||0,min:b.y.min||0,max:b.y.max||20},beacon:{width:c.width(),height:c.height(),position:function(){c.css({bottom:d.y.col*d.y.base+d.y.base/2-this.height/2,left:d.x.row*d.x.base+d.x.base/2-this.width/2})}},setCoordsFromOffset:function(a,b){var c=this.x.value,d=this.y.value,f=Math.floor((a-this.left)/this.x.base),g=this.y.max-this.y.min-Math.floor((b-this.top)/this.y.base);f>=0&&f<this.rows&&(this.x.row=Math.floor((a-this.left)/this.x.base),this.x.value=this.x.row+this.x.min),g>=0&&g<this.cols&&(this.y.col=this.y.max-this.y.min-Math.floor((b-this.top)/this.y.base),this.y.value=this.y.col+this.y.min),(c!=this.x.value||d!=this.y.value)&&e.trigger("change")},setCoords:function(a,b){var c=this.x.value,d=this.y.value;this.x.value=a,this.x.row=this.x.value-this.x.min,this.y.value=b,this.y.col=this.y.value-this.y.min,(c!=this.x.value||d!=this.y.value)&&e.trigger("change")},startDrag:function(){e.on("mousemove",function(a){d.setCoordsFromOffset(a.pageX,a.pageY)})},stopDrag:function(){e.off("mousemove")}},d.rows=d.x.max-d.x.min+1,d.x.base=d.width/d.rows,d.x.value<d.x.min?d.x.value=d.x.min:d.x.value>d.x.max&&(d.x.value=d.x.max),d.cols=d.y.max-d.y.min+1,d.y.base=d.height/d.cols,d.y.value<d.y.min?d.y.value=d.y.min:d.y.value>d.y.max&&(d.y.value=d.y.max),d.x.initValue=d.x.value,d.y.initValue=d.y.value,d.setCoords(d.x.value,d.y.value),d.beacon.position(),e.on("mousedown",function(a){d.setCoordsFromOffset(a.pageX,a.pageY),d.startDrag()}).on("change",function(){d.beacon.position()}),a(document).on("mouseup",function(a){d.stopDrag()}))})},getCoords:function(){return{x:d.x.value,y:d.y.value}},setCoords:function(a){d.setCoords(a.x,a.y)},reset:function(){d.setCoords(d.x.initValue,d.y.initValue)}};a.fn.inputGrid=function(b){if(e[b])return e[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return e.init.apply(this,arguments);a.error("Method "+b+" does not exist on jQuery.inputGrid")}})